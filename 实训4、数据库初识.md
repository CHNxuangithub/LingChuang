出现的网络问题：

```
[root@week1 yum.repos.d]# wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo
--2023-03-27 14:50:20--  https://mirrors.aliyun.com/repo/Centos-7.repo
正在解析主机 mirrors.aliyun.com (mirrors.aliyun.com)... 失败：未知的名称或服务。
wget: 无法解析主机地址 “mirrors.aliyun.com”
[root@week1 yum.repos.d]# ping www.baidu.com
ping: www.baidu.com: 未知的名称或服务
```



解决方法：

1.![1679900067924](华立笔记4.assets/1679900067924.png)



虚拟机一定要跟你子网的网段一致，并且网关要一样

2.![1679900249437](华立笔记4.assets/1679900249437.png)



3.加入网关进此/etc/resolv.conf 文件

例：

```
[root@week1 ~]# cat /etc/resolv.conf 
# Generated by NetworkManager
nameserver 192.168.41.2
```







### 1.今日目标

安装之前请初始化环境，不然可能出现各种错

mysql数据库

1.安装数据库5.5并初始化

2.建库建表建数据并导出

3.体验升级mysql5.7版本

4.再体验数据迁移







### 2.数据库分哪两种类型？

关系型与非关系型

但关系型代表是谁？mysql（被甲骨文公司收购了）和oracle(甲骨文公司的王牌软件，大公司，商业版的)

非关系型是：mongodb（json格式的文档型数据库）和redis（key=value   必须会的，缓存型数据库，典型应用场景：微博）

新型分布式数据库：性能更高，高可用，高可靠，天生支持分布式 ，TIDB，POLARDB



centos7以前的版本，是有mysql的安装，但到centos7变成了mariadb



### 3.安装本地数据库

[root@huali1 yum.repos.d]# yum install -y mariadb-server mariadb

查看版本：

mysql -V

启动数据库：

[root@huali1 yum.repos.d]# systemctl start mariadb
[root@huali1 yum.repos.d]# systemctl status mariadb

[root@huali1 yum.repos.d]# mysql_secure_installation    #安全配置初始化

```
NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB
      SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!

In order to log into MariaDB to secure it, we'll need the current
password for the root user.  If you've just installed MariaDB, and
you haven't set the root password yet, the password will be blank,
so you should just press enter here.

Enter current password for root (enter for none):        #请输入root密码，因为我们之前没有密码，所以这里直接回车

Setting the root password ensures that nobody can log into the MariaDB
root user without the proper authorisation.

Set root password? [Y/n]					#是否要设置root密码
New password: 								#输入两次密码
Re-enter new password: 
Password updated successfully!
Reloading privilege tables..
 ... Success!


By default, a MariaDB installation has an anonymous user, allowing anyone
to log into MariaDB without having to have a user account created for
them.  This is intended only for testing, and to make the installation
go a bit smoother.  You should remove them before moving into a
production environment.

Remove anonymous users? [Y/n]  					#是否移除匿名用户，为了数据库安全起见，选择y

Normally, root should only be allowed to connect from 'localhost'.  This
ensures that someone cannot guess at the root password from the network.

Disallow root login remotely? [Y/n]				#是否允许root远程登录,要选择y，不然不能通过第三方软件进行登录

By default, MariaDB comes with a database named 'test' that anyone can
access.  This is also intended only for testing, and should be removed
before moving into a production environment.

Remove test database and access to it? [Y/n]			#是否要移除测试库，为了安全起见，选择y
- Dropping test database...
 ... Success!
 - Removing privileges on test database...
 ... Success!

Reloading the privilege tables will ensure that all changes made so far
will take effect immediately.

Reload privilege tables now? [Y/n]					#是否要更新权限表，一定要选择更新 y
... Success!

Cleaning up...

All done!  If you've completed all of the above steps, your MariaDB
installation should now be secure.

Thanks for using MariaDB!

```



### 4.数据库登录

方法1：

[root@huali1 yum.repos.d]# mysql -uroot -p123456     # -u 后接用户   -p后接密码

方法2：

[root@huali1 ~]# mysql -uroot -p
Enter password:

数据库创建数据流程：

先建库--->建表--->插入数据

```
MariaDB [(none)]> create database huali ;
Query OK, 1 row affected (0.00 sec)

MariaDB [(none)]> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| huali            |
+--------------------+
4 rows in set (0.00 sec)

MariaDB [(none)]> use huali
Database changed
MariaDB [huali]> show tables;
Empty set (0.00 sec)

MariaDB [huali]> create table person(				#写法1
    -> id int,
    -> name varchar(15),
    -> math char(10),
    -> chinese char(10),
    -> english char(10),
    -> );

MariaDB [huali]> create table person( id int, name varchar(15), math char(10), chinese char(10), english char(10) );										#写法2
Query OK, 0 rows affected (0.00 sec)

MariaDB [huali]> show tables;
+-------------------+
| Tables_in_huali |
+-------------------+
| person            |
+-------------------+
1 row in set (0.00 sec)

MariaDB [huali]> select * from person;
Empty set (0.00 sec)

MariaDB [huali]> insert into person value(1,"lu",75,85,95);
Query OK, 1 row affected (0.01 sec)

MariaDB [huali]> select * from person;
+------+------+------+---------+---------+
| id   | name | math | chinese | english |
+------+------+------+---------+---------+
|    1 | lu   | 75   | 85      | 95      |
+------+------+------+---------+---------+
1 row in set (0.00 sec)

```

### 5.使用第三方软件远程连接

![image-20220622105414160](https://note-1308251438.cos.ap-guangzhou.myqcloud.com/typora/202206221054222.png)

主要原因就是权限不够

```
MariaDB [huali]> select user,host from mysql.user				#mysql.user是数据库的权限表
    -> ;
+------+-----------+
| user | host      |
+------+-----------+
| root | 127.0.0.1 |
| root | ::1       |
| root | localhost |
+------+-----------+
3 rows in set (0.00 sec)

MariaDB [huali]> update mysql.user set host='%' where host='localhost';		
Query OK, 1 row affected (0.00 sec)								#更新root登录权限，%代表所有网段都可以登录
Rows matched: 1  Changed: 1  Warnings: 0

MariaDB [huali]> select user,host from mysql.user;
+------+-----------+
| user | host      |
+------+-----------+
| root | %         |
| root | 127.0.0.1 |
| root | ::1       |
+------+-----------+
3 rows in set (0.00 sec)

MariaDB [huali]> flush privileges;							#在数据库里修改了权限后，需要刷新一下权限
Query OK, 0 rows affected (0.00 sec)
```

![image-20220622105914832](https://note-1308251438.cos.ap-guangzhou.myqcloud.com/typora/202206221059876.png)

![image-20220622110407474](https://note-1308251438.cos.ap-guangzhou.myqcloud.com/typora/202206221104543.png)





### 6.导出数据

```
[root@huali1 ~]# mysqldump -uroot -p -B huali >/opt/huali.sql
Enter password: 
[root@huali1 ~]# ll /opt
总用量 4
-rw-r--r-- 1 root root 2115 6月  22 11:06 huali.sql
```

### 7.删除旧版本数据库

注：因为我们接下来要装新版本，如果还残留旧版本的文件，就会出现报错

[root@huali1 ~]# yum remove mariadb* -y

```
[root@huali1 ~]# which mysql
/usr/bin/which: no mysql in (/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin)

[root@huali1 ~]# whereis mysql
mysql: /usr/lib64/mysql
[root@huali1 ~]# rm -rf /usr/lib64/mysql

[root@huali1 ~]# find / -name "*mysql*"	 -exec rm -rf {} \;   #语法：find 路径 -name “文件名”：找到指定路径下与指定名字相关的文件  -exec 接着执行后面的命令
/etc/selinux/targeted/active/modules/100/mysql
/root/.mysql_history
/var/lib/mysql
/var/lib/mysql/mysql
/usr/lib/firewalld/services/mysql.xml
/usr/share/vim/vim74/syntax/mysql.vim
/mnt/Packages/akonadi-mysql-1.9.2-4.el7.x86_64.rpm
/mnt/Packages/dovecot-mysql-2.2.10-8.el7.x86_64.rpm
/mnt/Packages/libdbi-dbd-mysql-0.8.3-16.el7.x86_64.rpm
/mnt/Packages/mysql-connector-odbc-5.2.5-6.el7.x86_64.rpm
/mnt/Packages/mysql-connector-java-5.1.25-3.el7.noarch.rpm
/mnt/Packages/pcp-pmda-mysql-3.11.8-7.el7.x86_64.rpm
/mnt/Packages/php-mysql-5.4.16-42.el7.x86_64.rpm
/mnt/Packages/qt5-qtbase-mysql-5.6.2-1.el7.x86_64.rpm
/mnt/Packages/qt-mysql-4.8.5-13.el7.x86_64.rpm
/mnt/Packages/rsyslog-mysql-8.24.0-12.el7.x86_64.rpm

[root@huali1 ~]# rm -rf /etc/selinux/targeted/active/modules/100/mysql /root/.mysql_history /var/lib/mysql /var/lib/mysql/mysql /usr/lib/firewalld/services/mysql.xml /usr/share/vim/vim74/syntax/mysql.vim

[root@huali1 ~]# find / -name "*mysql*"			#剩下以/mnt开头的是镜像包的安装包，不要删
/mnt/Packages/akonadi-mysql-1.9.2-4.el7.x86_64.rpm
/mnt/Packages/dovecot-mysql-2.2.10-8.el7.x86_64.rpm
/mnt/Packages/libdbi-dbd-mysql-0.8.3-16.el7.x86_64.rpm
/mnt/Packages/mysql-connector-odbc-5.2.5-6.el7.x86_64.rpm
/mnt/Packages/mysql-connector-java-5.1.25-3.el7.noarch.rpm
/mnt/Packages/pcp-pmda-mysql-3.11.8-7.el7.x86_64.rpm
/mnt/Packages/php-mysql-5.4.16-42.el7.x86_64.rpm
/mnt/Packages/qt5-qtbase-mysql-5.6.2-1.el7.x86_64.rpm
/mnt/Packages/qt-mysql-4.8.5-13.el7.x86_64.rpm
/mnt/Packages/rsyslog-mysql-8.24.0-12.el7.x86_64.rpm

```

### 8.安装新版本mysql

mysql官方网站：https://www.mysql.com/

下载yum源仓库的地址 http://repo.mysql.com/yum/mysql-5.7-community/el/7/x86_64/

```
[root@huali1 opt]# wget http://repo.mysql.com/yum/mysql-5.7-community/el/7/x86_64/mysql57-community-release-el7-10.noarch.rpm

[root@huali1 opt]# rpm -ivh mysql57-community-release-el7-10.noarch.rpm   #解压后会生成两个mysql的yum源仓库文件
警告：mysql57-community-release-el7-10.noarch.rpm: 头V3 DSA/SHA1 Signature, 密钥 ID 5072e1f5: NOKEY
准备中...                          ################################# [100%]
正在升级/安装...
   1:mysql57-community-release-el7-10 ################################# [100%]
   
有时候这个rpm解压不出文件，可以采取第二种方法：
可以先下载这个RPM包，再拉到虚拟机上
[root@huali1 ~]# yum install -y lrzsz		#安装此软件后，可以用鼠标把文件移动到虚拟机上


[root@huali1 opt]# cd /etc/yum.repos.d/
[root@huali1 yum.repos.d]# ll
总用量 16
drwxr-xr-x 2 root root  205 6月  22 10:11 bak
-rw-r--r-- 1 root root 2523 6月  22 10:14 CentOS-Base.repo
-rw-r--r-- 1 root root   82 6月  22 10:17 local.repo
-rw-r--r-- 1 root root 1627 4月   5 2017 mysql-community.repo
-rw-r--r-- 1 root root 1663 4月   5 2017 mysql-community-source.repo
[root@huali1 yum.repos.d]# yum repolist			#刷新一下缓存
[root@huali1 yum.repos.d]# yum install -y mysql-community-server   #默认安装最新版本
```



注：出现报错

```
从 file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql 检索密钥
导入 GPG key 0x5072E1F5:
 用户ID     : "MySQL Release Engineering <mysql-build@oss.oracle.com>"
 指纹       : a4a9 4068 76fc bd3c 4567 70c8 8c71 8d3b 5072 e1f5
 软件包     : mysql57-community-release-el7-10.noarch (installed)
 来自       : /etc/pki/rpm-gpg/RPM-GPG-KEY-mysql


mysql-community-libs-compat-5.7.41-1.el7.x86_64.rpm 的公钥尚未安装


 失败的软件包是：mysql-community-libs-compat-5.7.41-1.el7.x86_64
 GPG  密钥配置为：file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql

[root@week1 yum.repos.d]# ll
总用量 12
-rw-r--r--. 1 root root    0 3月  27 14:50 CentOS-Base.repo
-rw-r--r--. 1 root root   74 3月  27 14:49 local.repo
-rw-r--r--. 1 root root 1627 4月   5 2017 mysql-community.repo
-rw-r--r--. 1 root root 1663 4月   5 2017 mysql-community-source.repo
[root@week1 yum.repos.d]# vim mysql-community.repo 
[mysql57-community]
name=MySQL 5.7 Community Server
baseurl=http://repo.mysql.com/yum/mysql-5.7-community/el/7/$basearch/
enabled=1
gpgcheck=0				改：此参数为0，即不检查密钥

```

然后重新执行命令

```
[root@huali1 yum.repos.d]# yum install -y mysql-community-server
```











查看版本：

[root@huali1 yum.repos.d]# mysql -V
mysql  Ver 14.14 Distrib 5.7.38, for Linux (x86_64) using  EditLine wrapper

启动服务：

```shell
[root@huali1 yum.repos.d]# systemctl status mysqld
● mysqld.service - MySQL Server
   Loaded: loaded (/usr/lib/systemd/system/mysqld.service; enabled; vendor preset: disabled)
   Active: inactive (dead)
     Docs: man:mysqld(8)
           http://dev.mysql.com/doc/refman/en/using-systemd.html

[root@huali1 yum.repos.d]# systemctl start mysqld

[root@huali1 yum.repos.d]# systemctl status mysqld
● mysqld.service - MySQL Server
   Loaded: loaded (/usr/lib/systemd/system/mysqld.service; enabled; vendor preset: disabled)
   Active: active (running) since 三 2022-06-22 14:09:34 CST; 3s ago
     Docs: man:mysqld(8)
           http://dev.mysql.com/doc/refman/en/using-systemd.html
  Process: 18848 ExecStart=/usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid $MYSQLD_OPTS (code=exited, status=0/SUCCESS)
  Process: 18799 ExecStartPre=/usr/bin/mysqld_pre_systemd (code=exited, status=0/SUCCESS)
 Main PID: 18851 (mysqld)
   CGroup: /system.slice/mysqld.service
           └─18851 /usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid

6月 22 14:09:31 huali1 systemd[1]: Starting MySQL Server...
6月 22 14:09:34 huali1 systemd[1]: Started MySQL Server.

```

报错：

```
[root@huali1 yum.repos.d]# mysql -uroot -p
Enter password: 
ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: YES)			#密码不对
```

在5.7的版本里，安装完数据库后，需要初始化root密码，可以通过查看/var/log/mysqld.log数据库日志获取临时密码

注：如果旧版本删除不干净，会残留/var/lib/mysql这一文件，会影响临时密码生成

解决方案：可以删除/var/lib/mysql这一文件，再重启数据库服务，就可以有临时密码生成

注：如果临时密码已经生成，千万不要删除/var/lib/mysql这一文件，不然直接影响使用mysql，需要重装mysql



临时密码获取：

方法1

```
[root@huali1 yum.repos.d]# cat /var/log/mysqld.log |grep password
2022-06-22T06:09:32.575517Z 1 [Note] A temporary password is generated for root@localhost: ZskGiUh3d#:s
```

方法2：

```
[root@huali1 yum.repos.d]# grep password /var/log/mysqld.log
2022-06-22T06:09:32.575517Z 1 [Note] A temporary password is generated for root@localhost: ZskGiUh3d#:s
```

注：通过临时密码进入到数据库后，需要立即修改数据库密码

由于5.7版本数据库密码设置非常严格，要求是大小写+数字+特殊符号+标点符号，所以我们要修改的密码限制

```
mysql> set global validate_password_policy=0;			#定义密码复杂度：0是只检查长度
Query OK, 0 rows affected (0.00 sec)

mysql> set global validate_password_length=1;			#定义密码长度，默认是>=8位数，设置为1后，长度>=4位数
Query OK, 0 rows affected (0.00 sec)

举例：
mysql> alter user 'root'@localhost identified by '123';
ERROR 1819 (HY000): Your password does not satisfy the current policy requirements

mysql> alter user 'root'@localhost identified by '123456';
Query OK, 0 rows affected (0.00 sec)

```

此时，数据库已正常可以使用

### 9.数据迁移

方法1：

```
[root@huali1 opt]# mysql -uroot -p  </opt/huali.sql				#在命令行导入数据库数据
Enter password: 
[root@huali1 opt]# mysql -uroot -p						#登录数据库验证
Enter password: 
mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| huali            |
| sys                |
+--------------------+
5 rows in set (0.00 sec)

mysql> use huali
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql> show tables;
+-------------------+
| Tables_in_huali |
+-------------------+
| person            |
+-------------------+
1 row in set (0.00 sec)

mysql> select * from person;
+------+------+------+---------+---------+
| id   | name | math | chinese | english |
+------+------+------+---------+---------+
|    1 | lu   | 85   | 99      | 95      |
+------+------+------+---------+---------+
1 row in set (0.00 sec)
```

方法2：

```
[root@huali1 opt]# mysql -uroot -p						#登录数据库
Enter password:
mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| sys                |
+--------------------+
4 rows in set (0.00 sec)

mysql> source /opt/huali.sql							#进入数据库里面导入
mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| huali            |
| sys                |
+--------------------+
5 rows in set (0.00 sec)

```



作业：

要求1：

截图：在虚拟机里执行mysql -V，一个是5.5版本，一个是5.7版 本的，主机名是你们名字拼音，不能缩写

要求2：

在5.7数据库里执行show databases:的结果要有导入的库名，还需要select * from 表的结果

